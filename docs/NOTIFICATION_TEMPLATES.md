# 알림 타입별 리텐션 멘트

## 알림 타입 정의 및 메시지 템플릿

### 1. EXPIRY_D2 (만료 2일 전)
**목적**: 만료 임박 전 마지막 기회 제시
**대상**: 만료 예정 사용자
**멘트**:
```
🔔 안녕하세요!

당신의 프리미엄 멤버십이 2일 후 만료됩니다.
지금 바로 갱신하고 계속해서 특별한 혜택을 누려보세요!

✨ 멤버십 갱신 시 제한 없는 접근권한 보장
💎 프리미엄 콘텐츠 무제한 이용

⏰ 서둘러주세요. 시간이 얼마 남지 않았습니다!
```

### 2. EXPIRY_D0 (만료 당일)
**목적**: 긴급 갱신 유도
**대상**: 오늘 만료되는 사용자
**멘트**:
```
⚠️ 긴급 알림!

당신의 프리미엄 멤버십이 오늘 만료됩니다.

지금 바로 갱신하지 않으면 
모든 프리미엄 기능에 접근할 수 없게 됩니다.

🚨 지금 바로 갱신하기 →
```

### 3. ATTENDANCE_D2 (출석 미달 2일 전)
**목적**: 출석 미달 회복 유도
**대상**: 출석 일수 미달 사용자
**멘트**:
```
📅 출석 기회를 놓치고 있어요!

현재 출석 일수: [current_count]일
목표 출석 일수: [target_count]일
남은 일수: 2일

지금이 마지막 기회입니다!
다음 2일 동안 출석하면 
보상을 받을 수 있습니다.

✅ 지금 바로 출석 체크하기 →
```

### 4. TICKET_ZERO (기회 소진)
**목적**: 긴급 회원가입 유도
**대상**: 남은 기회가 0인 사용자
**멘트**:
```
😢 더 이상의 기회가 없습니다.

당신의 모든 기회를 다 소진했습니다.

하지만 아직 희망은 있습니다!

🆕 새로운 프리미엄 멤버십으로
무제한 기회를 얻으세요!

💰 특별 할인가: 지금 가입하면 50% 할인!

⏰ 이 특가는 24시간만 유효합니다.
```

### 5. SOCIAL_PROOF (사용자 증명/동기부여)
**목적**: 사회적 증명을 통한 재참여 유도
**대상**: 비활동 또는 저활동 사용자
**멘트**:
```
🌟 당신도 이들처럼 성공할 수 있습니다!

지금 활동 중인 프리미엄 회원들:
- 5,234명이 이번 달 목표를 달성했어요!
- 평균 참여도: 87%
- 평균 보상: 1,250,000원

당신도 그들의 일원이 될 수 있습니다.

✨ 지금 시작하면 무엇이 다를까요?

→ 성공 사례 확인하기
→ 지금 바로 시작하기
```

---

## 데이터베이스 스키마 추가

### notification_templates 테이블
```sql
CREATE TABLE IF NOT EXISTS notification_templates (
  id SERIAL PRIMARY KEY,
  type VARCHAR(32) NOT NULL UNIQUE,
  title VARCHAR(128) NOT NULL,
  body TEXT NOT NULL,
  cta_text VARCHAR(64),  -- Call-to-action 버튼 텍스트
  icon_emoji VARCHAR(2),
  category VARCHAR(32),  -- URGENT | REMINDER | SOCIAL_PROOF
  priority INT DEFAULT 0,
  enabled BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);
```

### 초기 데이터
```sql
INSERT INTO notification_templates (type, title, body, cta_text, icon_emoji, category, priority) VALUES
  ('EXPIRY_D2', 
   '만료 2일 전 - 마지막 기회!',
   '🔔 안녕하세요!

당신의 프리미엄 멤버십이 2일 후 만료됩니다.
지금 바로 갱신하고 계속해서 특별한 혜택을 누려보세요!

✨ 멤버십 갱신 시 제한 없는 접근권한 보장
💎 프리미엄 콘텐츠 무제한 이용

⏰ 서둘러주세요. 시간이 얼마 남지 않았습니다!',
   '지금 갱신하기',
   '🔔',
   'REMINDER',
   1),
  
  ('EXPIRY_D0',
   '긴급: 오늘 만료됩니다!',
   '⚠️ 긴급 알림!

당신의 프리미엄 멤버십이 오늘 만료됩니다.

지금 바로 갱신하지 않으면 
모든 프리미엄 기능에 접근할 수 없게 됩니다.

🚨 지금 바로 갱신하기 →',
   '지금 갱신하기',
   '⚠️',
   'URGENT',
   2),
  
  ('ATTENDANCE_D2',
   '출석 기회를 놓치고 있어요!',
   '📅 출석 기회를 놓치고 있어요!

현재 출석 일수: [CURRENT_COUNT]일
목표 출석 일수: [TARGET_COUNT]일
남은 일수: 2일

지금이 마지막 기회입니다!
다음 2일 동안 출석하면 
보상을 받을 수 있습니다.

✅ 지금 바로 출석 체크하기 →',
   '출석하기',
   '📅',
   'REMINDER',
   1),
  
  ('TICKET_ZERO',
   '기회 소진 - 새로운 시작!',
   '😢 더 이상의 기회가 없습니다.

당신의 모든 기회를 다 소진했습니다.

하지만 아직 희망은 있습니다!

🆕 새로운 프리미엄 멤버십으로
무제한 기회를 얻으세요!

💰 특별 할인가: 지금 가입하면 50% 할인!

⏰ 이 특가는 24시간만 유효합니다.',
   '특가로 가입하기',
   '😢',
   'URGENT',
   2),
  
  ('SOCIAL_PROOF',
   '당신도 이들처럼 성공할 수 있습니다!',
   '🌟 당신도 이들처럼 성공할 수 있습니다!

지금 활동 중인 프리미엄 회원들:
- 5,234명이 이번 달 목표를 달성했어요!
- 평균 참여도: 87%
- 평균 보상: 1,250,000원

당신도 그들의 일원이 될 수 있습니다.

✨ 지금 시작하면 무엇이 다를까요?

→ 성공 사례 확인하기
→ 지금 바로 시작하기',
   '시작하기',
   '🌟',
   'SOCIAL_PROOF',
   0);
```

---

## API 개선

### `/api/vault/notify` 요청 시 메시지 포함
```json
{
  "type": "EXPIRY_D2",
  "variant_id": "A",
  "scheduled_at": "2025-12-27T10:00:00Z",
  "external_user_ids": ["ext-1001", "ext-1002"],
  "message_override": null  // 옵션: 기본 템플릿 대신 커스텀 메시지 사용
}
```

### `/api/vault/admin/notifications` 응답에 메시지 포함
```json
{
  "items": [
    {
      "id": 123,
      "type": "EXPIRY_D2",
      "variant_id": "A",
      "status": "SENT",
      "title": "만료 2일 전 - 마지막 기회!",
      "body": "🔔 안녕하세요!...",
      "cta_text": "지금 갱신하기",
      "scheduled_at": "2025-12-27T10:00:00Z",
      "created_at": "2025-12-25T15:30:00Z"
    }
  ]
}
```

---

## 프론트엔드 구현

AdminV2NotificationsPanel에서 메시지 프리뷰:
1. 알림 타입 선택 시 템플릿 자동 표시
2. 메시지 미리보기 섹션 추가
3. 커스텀 메시지 입력 옵션 제공
