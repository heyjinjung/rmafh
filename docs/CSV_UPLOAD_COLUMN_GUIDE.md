# CSV ì—…ë¡œë“œ í•„ìˆ˜ ì»¬ëŸ¼ ê°€ì´ë“œ

## 1. CSV íŒŒì¼ êµ¬ì¡°

ì–´ë“œë¯¼ í˜ì´ì§€(`/admin/`)ì—ì„œ ì¼ì¼ ìœ ì € ë°ì´í„° ì—…ë¡œë“œì‹œ ì‚¬ìš©í•˜ëŠ” CSV íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.

### 1.1 í•„ìˆ˜ ì»¬ëŸ¼ (í•œê¸€)

| í•œê¸€ ì»¬ëŸ¼ëª… | ì˜ë¬¸ ì»¬ëŸ¼ëª… (í˜¸í™˜) | íƒ€ì… | í•„ìˆ˜ | ì„¤ëª… | ì˜ˆì‹œ |
|------------|-------------------|------|------|------|------|
| `ì•„ì´ë””` | `external_user_id` | ë¬¸ìì—´ | âœ… í•„ìˆ˜ | ì™¸ë¶€ ìœ ì € ì‹ë³„ì (ê³ ìœ ê°’) | `user_hong123`, `external_12345` |
| `ë‹‰ë„¤ì„` | `nickname` | ë¬¸ìì—´ | âš ï¸ ê¶Œì¥ | ìœ ì € ë‹‰ë„¤ì„ | `í™ê¸¸ë™`, `casino_pro` |
| `ì…ê¸ˆì•¡` | `deposit_total` | ìˆ«ì | âš ï¸ ê¶Œì¥ | ëˆ„ì  ì…ê¸ˆì•¡ (ì› ë‹¨ìœ„) | `1000000`, `500000` |
| `í…”ë ˆê·¸ë¨` | `telegram_ok` | ë¶ˆë¦¬ì–¸ | âš ï¸ ê¶Œì¥ | í…”ë ˆê·¸ë¨ ì¸ì¦ ì™„ë£Œ ì—¬ë¶€ | `true`, `false`, `1`, `0` |
| `ê°€ì…ì¼` | `joined_at` | ë‚ ì§œ/ë¬¸ìì—´ | âŒ ì„ íƒ | ê°€ì…ì¼ (YYYY-MM-DD ë˜ëŠ” ISO) | `2024-12-01`, `2024-12-01T10:30:00Z` |
| `ì…ê¸ˆì¼` | `last_deposit_at` | ë‚ ì§œ/ë¬¸ìì—´ | âŒ ì„ íƒ | ë§ˆì§€ë§‰ ì…ê¸ˆ ì‹œê° (ISO 8601) | `2024-12-22T14:30:00Z` |
| `ë¦¬ë·°` | `review_ok` | ë¶ˆë¦¬ì–¸ | âŒ ì„ íƒ | ë¦¬ë·° ì‘ì„± ì™„ë£Œ ì—¬ë¶€ | `true`, `false` |

**ğŸ’¡ ì¤‘ìš”**: í•œê¸€ ì»¬ëŸ¼ëª…ê³¼ ì˜ë¬¸ ì»¬ëŸ¼ëª… ëª¨ë‘ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤. í˜¼ìš©ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.

---

## 2. CSV ì˜ˆì‹œ

### 2.1 ìµœì†Œ êµ¬ì„± (í•œê¸€ ì»¬ëŸ¼ëª…)

```csv
ì•„ì´ë””,ë‹‰ë„¤ì„,ì…ê¸ˆì•¡,í…”ë ˆê·¸ë¨
user_hong,í™ê¸¸ë™,1000000,true
user_kim,ê¹€ì² ìˆ˜,500000,false
user_lee,ì´ì˜í¬,2000000,true
```

### 2.2 ì „ì²´ êµ¬ì„± (í•œê¸€ ì»¬ëŸ¼ëª…)

```csv
ì•„ì´ë””,ë‹‰ë„¤ì„,ì…ê¸ˆì•¡,í…”ë ˆê·¸ë¨,ê°€ì…ì¼,ì…ê¸ˆì¼,ë¦¬ë·°
user_hong,í™ê¸¸ë™,1000000,true,2024-12-01,2024-12-20T10:30:00Z,true
user_kim,ê¹€ì² ìˆ˜,500000,false,2024-12-10,2024-12-22T14:00:00Z,false
user_lee,ì´ì˜í¬,2000000,true,2024-11-25,2024-12-21T09:15:00Z,true
external_999,ìµœì˜ìˆ˜,750000,true,2024-12-15,,false
```

### 2.3 í˜¼ìš© ì˜ˆì‹œ (í•œê¸€+ì˜ë¬¸)

```csv
ì•„ì´ë””,ë‹‰ë„¤ì„,deposit_total,í…”ë ˆê·¸ë¨,joined_at
user_hong,í™ê¸¸ë™,1000000,true,2024-12-01
user_kim,ê¹€ì² ìˆ˜,500000,false,2024-12-10
```

---

## 3. ì»¬ëŸ¼ë³„ ìƒì„¸ ì„¤ëª…

### 3.1 `ì•„ì´ë””` (external_user_id) - í•„ìˆ˜

**ì„¤ëª…**: ì™¸ë¶€ ì‹œìŠ¤í…œ ìœ ì € ì‹ë³„ì, ë‚´ë¶€ `user_id`ì™€ ë§¤í•‘ë©ë‹ˆë‹¤.

**ê·œì¹™**:
- ì¤‘ë³µ ë¶ˆê°€ (CSV ë‚´ì—ì„œë„ ì¤‘ë³µ ì œê±°ë¨)
- ë¹ˆ ê°’ ë¶ˆê°€
- ìµœëŒ€ 10,000ê°œ í–‰ ì œí•œ

**ì²˜ë¦¬ ë¡œì§**:
- ê¸°ì¡´ ìœ ì €: `user_identity` í…Œì´ë¸”ì—ì„œ `user_id` ì¡°íšŒ
- ì‹ ê·œ ìœ ì €: ìë™ ìƒì„± í›„ `user_id` ë§¤í•‘

---

### 3.2 `nickname` (ê¶Œì¥)

**ì„¤ëª…**: ìœ ì € ë‹‰ë„¤ì„, UI í‘œì‹œìš©

**ê·œì¹™**:
- ë¹ˆ ê°’ í—ˆìš© (NULLë¡œ ì €ì¥)
- ìµœëŒ€ ê¸¸ì´: ì œí•œ ì—†ìŒ (DB TEXT íƒ€ì…)

**ì €ì¥ ìœ„ì¹˜**: `user_admin_snapshot.nickname`

---

### 3.3 `deposit_total` (ê¶Œì¥)

**ì„¤ëª…**: ëˆ„ì  ì…ê¸ˆì•¡, ë‹¤ì´ì•„ëª¬ë“œ í•´ê¸ˆ ì¡°ê±´ (`>= 500,000`)

**ê·œì¹™**:
- ìˆ«ìë§Œ ì…ë ¥ (ì‰¼í‘œ ì œê±°: `1,000,000` â†’ `1000000`)
- ìŒìˆ˜ ìë™ ë³´ì • â†’ 0
- ê¸°ë³¸ê°’: `0`

**ì˜í–¥**:
- `vault_status.diamond_deposit_current` ì—…ë°ì´íŠ¸
- `deposit_total >= 500,000` â†’ ë‹¤ì´ì•„ëª¬ë“œ ê¸ˆê³  `UNLOCKED`
- ì¶œì„ ì²´í¬: ì „ì¼ ëŒ€ë¹„ ì…ê¸ˆì•¡ `>= 50,000` â†’ ì¶œì„ ì¹´ìš´íŠ¸ ì¦ê°€

**ì €ì¥ ìœ„ì¹˜**:
- `user_admin_snapshot.deposit_total`
- `vault_status.diamond_deposit_current`

---

### 3.4 `telegram_ok` (ê¶Œì¥)

**ì„¤ëª…**: í…”ë ˆê·¸ë¨ ì¸ì¦ ì™„ë£Œ ì—¬ë¶€, ê³¨ë“œ í•´ê¸ˆ ì¡°ê±´

**ê·œì¹™**:
- `true`, `false`, `1`, `0`, `yes`, `no` í—ˆìš©
- ëŒ€ì†Œë¬¸ì ë¬´ì‹œ
- ê¸°ë³¸ê°’: `false`

**ì˜í–¥**:
- `telegram_ok = true` â†’ ê³¨ë“œ ê¸ˆê³  `UNLOCKED`

**ì €ì¥ ìœ„ì¹˜**:
- `user_admin_snapshot.telegram_ok`
- `vault_status.gold_status`

---

### 3.5 `joined_at` (ì„ íƒ)

**ì„¤ëª…**: ê°€ì…ì¼

**í˜•ì‹**:
- `YYYY-MM-DD` (ì˜ˆ: `2024-12-01`)
- ISO 8601 (ì˜ˆ: `2024-12-01T10:30:00Z`)

**ê·œì¹™**:
- íŒŒì‹± ì‹¤íŒ¨ì‹œ NULL
- ë¹ˆ ê°’ í—ˆìš©

**ì €ì¥ ìœ„ì¹˜**: `user_admin_snapshot.joined_date`

---

### 3.6 `last_deposit_at` (ì„ íƒ)

**ì„¤ëª…**: ë§ˆì§€ë§‰ ì…ê¸ˆ ì‹œê°, ì¶œì„ ë‚ ì§œ ê³„ì‚°ì— ì‚¬ìš©

**í˜•ì‹**: ISO 8601 (`2024-12-22T14:30:00Z`)

**ê·œì¹™**:
- íŒŒì‹± ì‹¤íŒ¨ì‹œ NULL
- ë¹ˆ ê°’ í—ˆìš©
- NULLì¼ ê²½ìš° ì˜¤ëŠ˜ ë‚ ì§œë¡œ ì¶œì„ ê³„ì‚°

**ì˜í–¥**:
- ì¶œì„ ë‚ ì§œ(`import_date`) ê³„ì‚°
- ì—°ì† ì¶œì„ ì²´í¬

**ì €ì¥ ìœ„ì¹˜**: `user_admin_snapshot.last_deposit_at`

---

### 3.7 `review_ok` (ì„ íƒ)

**ì„¤ëª…**: ë¦¬ë·° ì‘ì„± ì™„ë£Œ ì—¬ë¶€, í”Œë˜í‹°ë„˜ í•´ê¸ˆ ì¡°ê±´ ì¤‘ í•˜ë‚˜

**ê·œì¹™**:
- `true`, `false`, `1`, `0` í—ˆìš©
- ê¸°ë³¸ê°’: `false`

**ì˜í–¥**:
- `review_ok = true` + `ì¶œì„ 3ì¼` â†’ í”Œë˜í‹°ë„˜ ê¸ˆê³  `UNLOCKED`

**ì €ì¥ ìœ„ì¹˜**:
- `user_admin_snapshot.review_ok`
- `vault_status.platinum_status` (ì¡°ê±´ ì¶©ì¡±ì‹œ)

---

## 4. ì—…ë¡œë“œ ì œí•œì‚¬í•­

| í•­ëª© | ì œí•œ |
|------|------|
| ìµœëŒ€ í–‰ ìˆ˜ | 10,000 í–‰ |
| íŒŒì¼ í¬ê¸° | í”„ë¡ íŠ¸ì—”ë“œ ì œí•œ (ê¶Œì¥: < 5MB) |
| ì¤‘ë³µ ì œê±° | CSV ë‚´ ë™ì¼ `external_user_id` ì¤‘ë³µ ì œê±° |
| ì—ëŸ¬ ì²˜ë¦¬ | ì˜ëª»ëœ í–‰ì€ ìŠ¤í‚µ, ì²˜ë¦¬ ê°€ëŠ¥í•œ í–‰ë§Œ ì§„í–‰ |

---

## 5. API ì‘ë‹µ ì˜ˆì‹œ

### 5.1 ì„±ê³µ ì¼€ì´ìŠ¤

**ìš”ì²­**: 150í–‰ CSV ì—…ë¡œë“œ

**ì‘ë‹µ**:
```json
{
  "total": 150,
  "processed": 148,
  "identity_created": 5,
  "vault_rows_updated": 148
}
```

**ì„¤ëª…**:
- `total`: CSV ì´ í–‰ ìˆ˜
- `processed`: ì‹¤ì œ ì²˜ë¦¬ëœ í–‰ ìˆ˜ (ì¤‘ë³µ/ì˜¤ë¥˜ ì œì™¸)
- `identity_created`: ì‹ ê·œ ìœ ì € ìˆ˜
- `vault_rows_updated`: ê¸ˆê³  ìƒíƒœ ì—…ë°ì´íŠ¸ëœ ìœ ì € ìˆ˜

---

### 5.2 ì—ëŸ¬ ì¼€ì´ìŠ¤

**ì—ëŸ¬**: `EMPTY_ROWS`

```json
{
  "detail": "EMPTY_ROWS"
}
```

**ì›ì¸**: CSV íŒŒì¼ì— ìœ íš¨í•œ í–‰ì´ ì—†ìŒ

---

**ì—ëŸ¬**: `TOO_MANY_ROWS`

```json
{
  "detail": "TOO_MANY_ROWS"
}
```

**ì›ì¸**: 10,000í–‰ ì´ˆê³¼

---

## 6. ê¸ˆê³  í•´ê¸ˆ ì¡°ê±´ ì •ë¦¬

| ê¸ˆê³  íƒ€ì… | í•´ê¸ˆ ì¡°ê±´ | ê´€ë ¨ CSV ì»¬ëŸ¼ |
|-----------|-----------|---------------|
| **ê³¨ë“œ** | `telegram_ok = true` | `telegram_ok` |
| **í”Œë˜í‹°ë„˜** | `review_ok = true` **AND** `ì¶œì„ 3ì¼` | `review_ok`, `deposit_total`, `last_deposit_at` |
| **ë‹¤ì´ì•„ëª¬ë“œ** | `deposit_total >= 500,000` | `deposit_total` |

### 6.1 ì¶œì„ ì¡°ê±´

- **ì¶œì„ ì¸ì •**: ì „ì¼ ëŒ€ë¹„ ì…ê¸ˆì•¡ `>= 50,000ì›`
- **ì—°ì† ì¶œì„**: ì „ë‚  ì¶œì„í–ˆê³  ì˜¤ëŠ˜ë„ ì¡°ê±´ ì¶©ì¡±
- **ìµœëŒ€ ì¶œì„ì¼**: 3ì¼ (í”Œë˜í‹°ë„˜ í•´ê¸ˆ)

---

## 7. ìš´ì˜ ì‹œë‚˜ë¦¬ì˜¤

### 7.1 ì‹ ê·œ ìœ ì € ë“±ë¡

```csv
external_user_id,nickname,deposit_total,telegram_ok
new_user_001,ì‹ ê·œìœ ì €1,0,false
```

**ê²°ê³¼**:
- `user_identity` ìƒì„± (user_id ìë™ í• ë‹¹)
- `vault_status` ê¸°ë³¸ í–‰ ìƒì„± (ê³¨ë“œ/í”Œë˜í‹°ë„˜/ë‹¤ì´ì•„ ëª¨ë‘ `LOCKED`)
- 72ì‹œê°„ ë§Œë£Œ íƒ€ì´ë¨¸ ì‹œì‘

---

### 7.2 ê³¨ë“œ í•´ê¸ˆ

```csv
external_user_id,nickname,deposit_total,telegram_ok
existing_user,ê¸°ì¡´ìœ ì €,100000,true
```

**ê²°ê³¼**:
- `vault_status.gold_status` â†’ `UNLOCKED`

---

### 7.3 ë‹¤ì´ì•„ëª¬ë“œ í•´ê¸ˆ

```csv
external_user_id,nickname,deposit_total,telegram_ok
vip_user,VIPìœ ì €,1000000,true
```

**ê²°ê³¼**:
- `vault_status.diamond_status` â†’ `UNLOCKED`
- `vault_status.gold_status` â†’ `UNLOCKED`

---

### 7.4 í”Œë˜í‹°ë„˜ í•´ê¸ˆ (3ì¼ ì—°ì† ì¶œì„)

**Day 1**:
```csv
external_user_id,deposit_total,last_deposit_at,review_ok
user_abc,100000,2024-12-20T10:00:00Z,true
```

**Day 2** (ì „ì¼ ëŒ€ë¹„ +50,000):
```csv
external_user_id,deposit_total,last_deposit_at,review_ok
user_abc,150000,2024-12-21T10:00:00Z,true
```

**Day 3** (ì „ì¼ ëŒ€ë¹„ +50,000):
```csv
external_user_id,deposit_total,last_deposit_at,review_ok
user_abc,200000,2024-12-22T10:00:00Z,true
```

**ê²°ê³¼**:
- `vault_status.platinum_attendance_days` â†’ `3`
- `vault_status.platinum_status` â†’ `UNLOCKED`

---

## 8. FAQ

### Q1. CSVì—ì„œ ë¹ˆ ê°’ì€ ì–´ë–»ê²Œ ì²˜ë¦¬ë˜ë‚˜ìš”?

**A**: 
- `external_user_id`: ë¹ˆ ê°’ì´ë©´ í•´ë‹¹ í–‰ ìŠ¤í‚µ
- `nickname`, `joined_at`, `last_deposit_at`: NULLë¡œ ì €ì¥
- `deposit_total`: `0`ìœ¼ë¡œ ì²˜ë¦¬
- `telegram_ok`, `review_ok`: `false`ë¡œ ì²˜ë¦¬

---

### Q2. ì¤‘ë³µëœ `external_user_id`ê°€ ìˆìœ¼ë©´?

**A**: CSV ë‚´ ì¤‘ë³µì€ ì œê±°ë˜ê³ , ì²« ë²ˆì§¸ í–‰ë§Œ ì²˜ë¦¬ë©ë‹ˆë‹¤.

---

### Q3. ê¸°ì¡´ ìœ ì € ë°ì´í„°ë¥¼ ë®ì–´ì“°ë‚˜ìš”?

**A**: ë„¤, `ON CONFLICT DO UPDATE` ë°©ì‹ìœ¼ë¡œ ìµœì‹  ë°ì´í„°ë¡œ ê°±ì‹ í•©ë‹ˆë‹¤.

---

### Q4. ë‚ ì§œ í˜•ì‹ì´ ì˜ëª»ë˜ë©´?

**A**: íŒŒì‹± ì‹¤íŒ¨ì‹œ NULLë¡œ ì €ì¥ë˜ë©°, ì—ëŸ¬ëŠ” ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

---

## 9. ì°¸ê³  ë¬¸ì„œ

- [API ìŠ¤í™](API_SPEC_VAULT_V2.md)
- [DB ì„¤ê³„](DB_DESIGN_VAULT_V2.md)
- [ì–´ë“œë¯¼ ê°€ì´ë“œ](ADMIN_GUIDE_VAULT_V2.md)
- [ê°ì‚¬ ë¡œê·¸ ìš´ì˜ ê°€ì´ë“œ](ADMIN_AUDIT_OPERATIONS_GUIDE.md)

---

**ì‘ì„±ì¼**: 2024-12-22  
**ë²„ì „**: 1.0  
**ë‹´ë‹¹ì**: Backend Team
